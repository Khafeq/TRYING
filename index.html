<!doctype html>
<html lang="ar">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>AppelBoom v7.0 - Designed by ME</title>
<style>
  /* ---------- ØªØµÙ…ÙŠÙ… Ø¹Ø§Ù… ÙˆØ­Ù„ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„ØµÙˆØ± ---------- */
  :root{
    --slot-font: 30px;
    --slot-gap: 12px;
  }
  *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
  html,body{height:100%;margin:0;padding:0;background:#222}
  .wrap{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;padding:12px}
  .stage{
    width:100%;max-width:1320px;height:calc(100vh - 24px);position:relative;border-radius:8px;overflow:hidden;
    background-color:#000;
  }

  /* Ø§Ù„Ø®Ù„ÙÙŠØ©: Ù†ØºØ·ÙŠ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆÙ†Ø³ØªØ®Ø¯Ù… object-fit:cover Ù„Ø¶Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
  .bg{
    position:absolute;inset:0;z-index:0;background-size:cover;background-position:center center;filter:none;
  }

  header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  pointer-events: none;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø£Ø³ÙÙ„ ÙˆÙˆØ³Ø· Ø§Ù„Ø´Ø§Ø´Ø© */
header .title {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(calc(-50% + 30px));
  font-weight: 800;
  color: #fff;
  z-index: 10000;
  padding: 12px 24px;
  background: rgba(0, 0, 0, 0.7);
  border-radius: 8px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  pointer-events: auto;
}

/* Ø²Ø± Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ† Ø§Ù„Ø£Ø³ÙÙ„ */
header .controls {
  position: absolute;
  bottom: 30px;
  right: 120px;
  z-index: 10000;
  display: flex;
  gap: 8px;
  align-items: center;
  padding: 0;
  background: transparent !important;
  border-radius: 0;
  backdrop-filter: none;
  border: none !important;
}

.sound-toggle {
  padding: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.9);
  border: none;
  cursor: pointer;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0;
  position: relative;
  z-index: 10001;
  pointer-events: auto !important;
}

.sound-toggle::before {
  content: "ğŸ”Š";
  font-size: 22px;
  pointer-events: none;
}

.sound-toggle.muted::before {
  content: "ğŸ”‡";
}

  /* ======= Ø§Ù„ØµÙØ­Ø©: ØªØµÙ…ÙŠÙ… Grid Ù…Ø±Ù† Ù„Ù„ØµÙØ­ØªÙŠÙ† ======= */
  .page{display:none;height:calc(100% - 64px);position:relative;z-index:5;padding:12px}
  .page.active{display:block}

  /* --- SETUP page --- */
  .lang-col {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 500px;
}

.setup {
  height: 100%;
  display: grid;
  grid-template-columns: 88px 1fr;
  gap: 12px;
  align-items: start;
}
  .lang-btn{width:72px;height:38px;border-radius:8px;background:rgba(255,255,255,0.92);display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:800}
  .lang-btn.active{background:#0b5138;color:white}
  
  .tree-wrap{
    position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;
  }
  
  .tree-frame {
  width: 90% !important;
  max-width: 740px !important;
  aspect-ratio: 4/3;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: -750px;
  margin-top: 65px;
}

.tree-img {
  position: absolute;
  left: 45% !important;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 135%;
  object-fit: cover;
  border-radius: 8px;
}
  
  .hero-apples, .tree-apples{position:absolute;left:7%;top:8%;width:86%;height:84%;pointer-events:none}
  .apple-item{position:absolute;transform:translate(-50%,-50%);display:flex;align-items:center;justify-content:center}
  .apple-item img{display:block;max-width:100%;height:auto;pointer-events:none}

  /* ğŸ†• Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ† */
  .input-container {
  position: absolute;
  right: 20px;
  top: 120px;
  width: 680px !important;
  z-index: 10;
}

.input-field {
  width: 100%;
  border: none;
  padding: 16px 20px !important;
  border-radius: 12px !important;
  background: white;
  color: #000;
  font-weight: 800;
  text-align: center;
  font-size: 22px !important;
  outline: none;
  letter-spacing: 4px;
  min-height: 60px;
}

.input-field.password-dots {
  font-size: 24px;
  letter-spacing: 8px;
  -webkit-text-security: disc; 
  text-security: disc;
}

.input-field::placeholder {
  color: #666;
  letter-spacing: normal;
  font-size: 16px;
}

  .start-col{position:absolute;right:20px;bottom:120px;display:flex;align-items:center;justify-content:center}
  .start-btn {
  padding: 24px 36px !important;
  border-radius: 16px !important;
  background: #0b5138;
  color: white;
  border: none;
  font-weight: 900;
  font-size: 26px !important;
  cursor: pointer;
  box-shadow: 0 12px 40px rgba(0,0,0,0.4);
  min-height: 100px;
  min-width: 180px;
}

  /* --- GAME page --- */
  .game{
    height:100%;
    display:grid;
    grid-template-columns:1fr 460px;
    grid-template-rows: 120px 1fr;
    gap:12px;
    align-items:start;
  }

  .word-top-section {
  grid-column: 1 / -1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 5px 10px;
  margin-top: -20px;
}

.slots-row {
  display: flex;
  justify-content: center;
  gap: var(--slot-gap,12px);
  align-items: center;
  min-height: 90px;
  margin-top: -10px !important;
}

  .left-game{
  position:relative;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding-top: 40px;
  width: 100%;
  padding-top: 0px;
}

.game-tree-frame{
  width:100% !important;
  max-width:750px !important;
  aspect-ratio: 4/3;
  position:relative;
  margin-left: -200px;
  margin-top: -110px;
}

.game-tree-img{
  position:absolute;
  left:40%;
  top:62%;
  transform:translate(-50%,-50%);
  width: 120% !important;
  height: 120% !important;
  object-fit: contain !important;
  border-radius:8px;
}
  
  .right-col{
    display:flex;
    flex-direction:column;
    gap:10px;
    padding:6px;
    height:100%;
  }

  .tree-apples {
  position: absolute;
  left: 12% !important;
  top: 8%;
  width: 76% !important;
  height: 84%;
  pointer-events: none;
}

  .slot{min-width:36px;border-bottom:3px solid rgba(255,255,255,0.12);padding:6px 8px;text-align:center;font-weight:900;font-size:var(--slot-font,30px);color:#fff}
  .slot.space{border-bottom:none}
  .alphabet{display:flex;flex-wrap:wrap;gap:8px;padding:8px;border-radius:8px;min-height:160px;align-items:flex-start;overflow:auto;justify-content:center}
  .letter-btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.94);cursor:pointer;min-width:40px;text-align:center;font-weight:800}
  .letter-btn.disabled{opacity:0.28;cursor:default}

  .fallen-columns{display:flex;gap:12px;overflow:auto;padding-top:100px;align-items:flex-start}
  .fallen-column{display:flex;flex-direction:column;gap:10px;align-items:center;width:84px}
  .fallen-item{display:flex;flex-direction:row;align-items:center;gap:8px}
  .fallen-letter{font-weight:900;font-size:18px;color:#111;margin-left:4px}

  .new-bottom {
  position: absolute;
  right: 20px;
  top: 350px;
  z-index: 8;
}

.new-btn {
  padding: 35px 20px;
  border-radius: 42px;
  background: #86198F !important;
  color: white !important;
  border: none;
  cursor: pointer;
  font-weight: 800;
  font-size: 16px;
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
  transition: all 0.3s ease;
  min-height: 50px;
}

.new-btn:hover {
  background: #5D2A2C !important;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
}

  /* modal */
  .modal{position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999}
  .modal.show{display:flex}
  .modal-card{background:white;padding:18px;border-radius:12px;min-width:320px;text-align:center}
  .modal-card img{max-width:320px;height:auto;border-radius:8px;margin:8px 0}
  .modal-btn{margin-top:12px;padding:8px 12px;border-radius:8px;border:none;background:#0b5138;color:white;cursor:pointer}

  .signature{display:none !important;}

  /* ğŸ†• ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ø´Ø±Ø·Ø§Øª - Ø§Ù„Ø§Ù„ØªÙØ§Ù Ø§Ù„Ø°ÙƒÙŠ */
  .slots-row {
      justify-content: center !important;
      padding: 0 10px !important;
      flex-wrap: wrap !important;
      gap: 2px !important;
      margin: 0 auto !important;
      max-width: 100% !important;
      text-align: center !important;
      overflow-x: visible !important;
      white-space: normal !important;
  }

  .slot {
      transition: all 0.3s ease !important;
      flex-shrink: 0 !important;
      display: inline-block !important;
  }

  /* ğŸ†• Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© - Ø£Ø­Ø¬Ø§Ù… Ø£ØµØºØ± Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù */
  .short-word .slot {
      font-size: 60px !important;
      min-width: 36px !important;
      font-weight: 900 !important;
  }

  .medium-word .slot {
      font-size: 45px !important;
      min-width: 30px !important;
  }

  .long-word .slot {
      font-size: 35px !important;
      min-width: 24px !important;
  }

  .very-long-word .slot {
      font-size: 25px !important;
      min-width: 20px !important;
  }

  .extremely-long-word .slot {
      font-size: 20px !important;
      min-width: 18px !important;
  }

  /* ğŸ†• Ù†Ù…Ø· Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© */
  .slot.revealed {
      color: #0b8a3a !important;
      font-weight: 900 !important;
  }

  /* ğŸ†• ØªØ¹Ø·ÙŠÙ„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØµÙˆØµ */
* {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.input-field {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

/* ================= ğŸ†• ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø­Ø³Ù†Ø© ================= */
/* Ù„Ø§ Ù†ØºÙŠØ± Ø£ÙŠ Ø´ÙŠØ¡ Ù„Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨ â€” ÙÙ‚Ø· Ø§Ù„ media queries Ø§Ù„ØªØ§Ù„ÙŠØ© */
@media (max-width: 1100px) and (orientation: landscape) {
  /* Mobile landscape: Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙŠØ³ÙƒØªÙˆØ¨ ØªÙ…Ø§Ù…Ù‹Ø§ */
  .stage { max-width: 1100px; padding: 6px; }
  /* Ù†ØµØºØ± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù†Ø³Ø¨ÙŠØ§Ù‹ Ù„ÙƒÙ† Ù„Ø§ Ù†ØºÙŠØ± Ø§Ù„ØªØ±ØªÙŠØ¨ */
  .tree-frame, .game-tree-frame { max-width: 78% !important; }
  .input-container { width: 56% !important; right: 12px; top: 110px; }
  .start-col { right: 12px; bottom: 100px; }
  .lang-col { margin-top: 60px; }
  .slots-row { min-height: 70px; margin-top: -10px; }
  .letter-btn { padding: 8px 10px; min-width:36px; font-size:14px; }
  .new-btn { padding: 28px 18px; min-height:50px; }
  header .controls { right: 20px; bottom: 12px; }
}

/* ======= Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¨ÙˆØ±ØªØ±ÙŠØª (Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø§Øµ Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡) ======= */
@media (max-width: 1100px) and (orientation: portrait) {

  /* Ù†Ø¹Ø·ÙŠ Ø§Ù„Ù€ stage ÙƒØ§Ù…Ù„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙˆÙ†Ù…Ù†Ø¹ Ø§Ù„Ù‚Øµ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ */
  .wrap { padding: 0; height:100vh; display:block; }
  .stage { max-width:100%; width:100%; height:100vh; border-radius:0; overflow:hidden; }

  /* --- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (setup) --- */
  .setup {
    display: block;
    height: 100%;
    padding: 0;
  }

  .lang-col {
    position: absolute;
    left: 12px;
    top: 45%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 15;
    margin-top: 0;
  }

  .tree-wrap {
    position: relative;
    width: 100%;
    height: 62vh; /* Ø§Ù„Ø´Ø¬Ø±Ø© ØªØ£Ø®Ø° Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙƒØ¨Ø± */
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .tree-frame {
    width: 92% !important;
    max-width: none !important;
    height: 100%;
    margin-left:0 !important;
    margin-top:0 !important;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .tree-img {
    position: absolute;
    left: 50% !important;
    top: 48%;
    transform: translate(-50%,-50%);
    width: auto;
    height: 100%;
    object-fit: contain;
    border-radius: 8px;
    z-index: 5;
  }

  /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø¬Ø±Ø© ÙŠØºØ·ÙŠ Ø§Ù„Ø¬Ø°Ø± - ØºÙŠØ± Ø´ÙØ§Ù - Ø·ÙˆÙ„ÙŠ */
  .input-container {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: calc(62vh * 0.12 + 72px); /* ÙŠØ¶Ø¹Ù‡ ÙÙˆÙ‚ Ø§Ù„Ø­Ø§ÙØ© ÙˆÙŠØºØ·ÙŠ Ø¬Ø°Ø¹ Ø§Ù„Ø´Ø¬Ø±Ø© */
    width: 86%;
    z-index: 18;
  }

  .input-field {
    width: 100%;
    background: #ffffff;
    color: #000;
    border-radius: 12px;
    padding: 18px 20px;
    font-size: 22px !important;
    letter-spacing: 3px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.35);
  }

  /* Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† ØªØ­Øª Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ù‚Ù„ÙŠÙ„ */
  .start-col {
    position: absolute;
    right: 18px;
    bottom: calc(62vh * 0.08 + 14px);
    z-index: 16;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .start-btn {
    min-width: 150px;
    min-height: 64px;
    padding: 14px 22px;
    font-size: 20px !important;
  }

  header .title {
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
    background: rgba(0,0,0,0.65);
    padding: 10px 18px;
    font-size: 14px;
  }

  header .controls {
    position: absolute;
    right: 12px;
    bottom: 8px;
    z-index: 20;
  }

  .sound-toggle { width: 42px; height:42px; }

  /* --- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (game) --- */
  .game {
    display: block;
    height: 100%;
    padding: 0;
    position: relative;
  }

  /* Ø§Ù„Ù†ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ: Ø§Ù„ÙƒÙ„Ù…Ø© Ø«Ù… Ø§Ù„Ø´Ø¬Ø±Ø© + Ø²Ø± New (ØªØ´ØºÙ„Ø§Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ) */
  .word-top-section {
    height: 18vh; /* Ø§Ù„ÙƒÙ„Ù…Ø© ØªØ£Ø®Ø° Ø­ÙŠØ² ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 6px 12px;
    margin-top: 6px;
    z-index: 20;
  }

  .slots-row {
    margin-top: 0 !important;
    min-height: 18vh !important;
    gap: 8px;
    padding: 6px 12px;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }

  /* Ø§Ù„Ø´Ø¬Ø±Ø© ØªØ­Øª Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ù…Ø¹ Ø²Ø± New Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ†Ù‡Ø§ â€” Ù…Ø¹Ù‹Ø§ ÙŠØ£Ø®Ø°Ø§Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
  .left-game {
    height: 32vh; /* Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
    display:flex;
    align-items:center;
    justify-content:center;
    position: relative;
  }

  .game-tree-frame {
    width: 56% !important;
    max-width: none !important;
    height: 100%;
    margin: 0 auto;
    position: relative;
  }

  .game-tree-img{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    width: auto !important;
    height: 92% !important;
    object-fit: contain !important;
    z-index: 6;
  }

  /* Ø²Ø± New Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† Ø§Ù„Ø´Ø¬Ø±Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù†ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
  .new-bottom {
    position: absolute;
    right: 8%;
    top: calc(18vh + 8vh); /* ÙÙˆÙ‚ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø¬Ø±Ø© ØªÙ‚Ø±ÙŠØ¨Ø§ */
    z-index: 18;
  }

  .new-btn {
    padding: 22px 16px;
    border-radius: 36px;
    min-height: 56px;
    font-size: 14px;
  }

  /* Ø§Ù„Ù†ØµÙ Ø§Ù„Ø³ÙÙ„ÙŠ: Ù…Ù‚Ø³ÙˆÙ… Ø±Ø£Ø³ÙŠÙ‹Ø§ â€” Ø§Ù„ÙŠÙ…ÙŠÙ†: Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø£ÙƒØ¨Ø± Ù…Ù…ÙƒÙ†)ØŒ Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„ØªÙØ§Ø­Ø§Øª Ø§Ù„Ø³Ø§Ù‚Ø·Ø© */
  .right-col {
    position: absolute;
    top: 50vh; /* Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù†ØµÙ Ø§Ù„Ø³ÙÙ„ÙŠ */
    left: 0;
    width: 100%;
    height: calc(50vh - 64px);
    display: flex;
    flex-direction: row;
    gap: 8px;
    padding: 8px 10px;
    z-index: 10;
    align-items:flex-start;
    justify-content:space-between;
  }

  /* fallen columns Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ù…Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø³ÙÙ„ÙŠ */
  .fallen-columns {
    width: 46%;
    padding-top: 12px;
    max-height: calc(50vh - 90px);
    overflow:auto;
  }
  .fallen-column{ width: 86px; align-items:center; }

  /* Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ù…Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø³ÙÙ„ÙŠ â€” Ø£ÙƒØ¨Ø± ÙˆØ£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ù‹Ø§ */
  .alphabet {
    width: 52%;
    padding: 12px;
    min-height: 180px;
    gap: 10px;
    overflow:auto;
    justify-content:flex-start;
    align-content:flex-start;
    display:flex;
    flex-wrap:wrap;
  }

  /* ØªÙƒØ¨ÙŠØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙˆÙ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù„Ù…Ø³ */
  .letter-btn {
    padding: 12px 16px !important;
    min-width: 54px !important;
    min-height: 48px !important;
    font-size: 18px !important;
    border-radius: 10px !important;
  }

  /* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø²Ø± Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
  header .title {
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 30;
    background: rgba(0,0,0,0.7);
    padding: 8px 16px;
  }

  header .controls {
    bottom: 8px;
    right: 12px;
    z-index: 30;
  }

  /* ØªØ£ÙƒØ¯ Ø£Ù† Ù„Ø§ ÙŠØ®Ø±Ø¬ Ø´ÙŠØ¡ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¥Ø·Ø§Ø± */
  .stage, .wrap, body, html { overflow: hidden; }

  /* Ø§Ø¬Ø¹Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ù„Ùˆ Ø§Ø­ØªØ§Ø¬Øª */
  .alphabet, .fallen-columns { -webkit-overflow-scrolling: touch; overflow:auto; }
}

/* Ø£Ø­Ø¬Ø§Ù… Ø£ØµØºØ± Ù„Ù‡ÙˆØ§ØªÙ ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ */
@media (max-width: 420px) and (orientation: portrait) {
  .input-field { font-size:18px !important; padding:14px 12px;}
  .start-btn { font-size:18px; padding:12px 18px;}
  .letter-btn { min-width:48px !important; padding:10px 12px !important; font-size:16px !important; }
  .slots-row.short-word .slot { font-size:36px !important; }
  .slots-row.medium-word .slot { font-size:26px !important; }
  .game-tree-frame { width: 68% !important; }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© */
@media (max-width: 1100px) and (min-width: 769px) { 
  .setup {
    grid-template-columns: 80px 1fr;
  }
  
  .tree-frame {
    width: 85% !important;
    margin-left: -600px !important;
  }
  
  .input-container {
    width: 500px !important;
  }
  
  .game-tree-frame {
    width: 85% !important;
    max-width: 600px !important;
  }
}

@media (max-width: 480px) {
  .lang-btn {
    width: 55px;
    height: 32px;
    font-size: 11px;
  }
  
  .input-field {
    font-size: 16px !important;
    padding: 12px 14px !important;
  }
  
  .start-btn {
    width: 180px;
    padding: 16px 20px !important;
    font-size: 18px !important;
  }
  
  .letter-btn {
    min-width: 35px;
    padding: 8px 10px;
    font-size: 13px;
  }
}
</style>
</head>
<body>
  <script>
/* config.js -- Appelboom v7 Settings - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ */
const settings = {
  
  // ========== ğŸ–¼ï¸ Ù‚Ø³Ù… Ø§Ù„ØµÙˆØ± ==========
  images: {
    background: "assets/images/background.jpg",
    tree: "assets/images/tree.png",
    apple: "assets/images/apple.png",
    appleTransparent: "assets/images/apple_transparent.png",
    crowdFail: "assets/images/crowd_fail.jpg",
    crowdWin: "assets/images/crowd_win.jpg",
    winImage: "assets/images/win.jpg"
  },

  // ========== ğŸ”Š Ù‚Ø³Ù… Ø§Ù„Ø£ØµÙˆØ§Øª ==========
  sounds: {
    birds: "assets/sounds/birds.mp3",
    click: "assets/sounds/click1.mp3",
    fallWhistle: "assets/sounds/fall_whistle.mp3",
    impact: "assets/sounds/impact.mp3",
    slide: "assets/sounds/slide.mp3",
    successList: [
      "assets/sounds/success1.mp3",
      "assets/sounds/success2.mp3"
    ],
    failList: [
      "assets/sounds/fail1.mp3",
      "assets/sounds/fail2.mp3"
    ],
    successMessage: "assets/sounds/success_message.mp3",
    failMessage: "assets/sounds/fail_message.mp3"
  },

  // ========== âš™ï¸ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==========
  options: {
    sound_enabled: true,
    check_dictionary_online: false,
    maxApplesPerColumn: 3,
    fallDurationMs: 700,
    bounceDurationMs: 420,
    bounceTiltDeg: 28,
    appleSizeBasePx: 38,
    slotFontSizePx: 26,
    slotUnderscoreSpacing: 10,
    arabicWordsFile: "assets/words_ar.json",
    
    // ğŸ†• Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ù„Ù„ÙƒÙ„Ù…Ø§Øª - Ù…ØµØ­Ø­Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø§Ù„ØªÙØ§Ù Ø§Ù„Ù…ØªØ£Ø®Ø±
    slotSizes: {
      short: 70,           // Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© (1-8 Ø£Ø­Ø±Ù) - ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ CSS
      medium: 35,          // Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© (9-16 Ø­Ø±Ù)
      long: 20,            // Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© (17-24 Ø­Ø±Ù)
      veryLong: 16,        // Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹ (25-30 Ø­Ø±Ù)
      extremelyLong: 14    // Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© (Ø£ÙƒØ«Ø± Ù…Ù† 30 Ø­Ø±Ù)
    }
  },

  // ========== ğŸ¨ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ==========

advanced: {
  tree: {
    setupPage: {
      width: "86%",
      maxWidth: "760px"
    },
    gamePage: {
      width: "95%",  // âœ… ØªØµØºÙŠØ± Ø§Ù„Ø´Ø¬Ø±Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
      maxWidth: "700px" // âœ… ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£Ù‚ØµÙ‰
    }
  }, 
    apples: {
      heroApples: {
        size: 38,
        fontSize: "18px"
      },
      fallenSize: 44,
      fallenLetterSize: 18
    },
    ui: {
      slots: {
        revealedColor: "#0b8a3a",
        revealedSizeIncrease: 4  // ğŸ†• ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ù„ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„ØªØµØºÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      }
    }
  },

  // ========== ğŸ”¤ Ù‚Ø³Ù… Ø§Ù„Ù„ØºØ§Øª ÙˆØ§Ù„Ù†ØµÙˆØµ ==========
  languages: {
    nl: ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","Ã","Ã€","Ã‰","Ãˆ","Ã‹","Ã","Ã","Ã“","Ã–","Ãš","Ãœ"],
    en: ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],
    ar: ["Ø§","Ø£","Ø¥","Ø¢","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","Ø¤","ÙŠ","Ø¦","Ù‰"]
  }
};
</script>

  <div class="wrap">
    <div class="stage" id="stage">
      <div id="bg" class="bg"></div>

      <header>
        <div class="title">Appelboom V7.0 - Designed by ME</div>
        <div class="controls">
          <button id="soundToggle" class="sound-toggle" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª"></button>
        </div>
      </header>

      <!-- PAGE SETUP -->
      <section id="pageSetup" class="page active">
        <div class="setup">
          <div class="lang-col" id="langCol">
            <div class="lang-btn active" data-lang="nl">NL</div>
            <div class="lang-btn" data-lang="en">EN</div>
            <div class="lang-btn" data-lang="ar">AR</div>
          </div>

          <div class="tree-wrap">
            <div class="tree-frame">
              <img id="heroTree" class="tree-img" src="" alt="tree" />
              <div id="heroApples" class="hero-apples"></div>
            </div>
          </div>
        </div>

        <div class="input-container">
          <input id="wordInput" class="input-field password-dots" autocomplete="off" 
                 placeholder="Typ het woord..." />
        </div>

        <div class="start-col">
          <button id="startBtn" class="start-btn">Start</button>
        </div>
      </section>

      <!-- PAGE GAME -->
      <section id="pageGame" class="page" aria-hidden="true">
        <div class="game">
          <div class="word-top-section">
            <div id="slotsRow" class="slots-row"></div>
          </div>
          
          <div class="left-game">
            <div class="game-tree-frame">
              <img id="gameTree" class="game-tree-img" src="" alt="tree" />
              <div id="treeApples" class="tree-apples"></div>
            </div>
          </div>

          <div class="right-col">
            <div id="fallenColumns" class="fallen-columns"></div>
            <div id="alphabet" class="alphabet"></div>
          </div>

          <div class="new-bottom">
            <button id="newBtn" class="new-btn">Nieuw / New</button>
          </div>
        </div>
      </section>

      <div class="modal" id="modal">
        <div class="modal-card">
          <h2 id="modalTitle"></h2>
          <div id="modalMedia"></div>
          <p id="modalDesc"></p>
          <button id="modalOk" class="modal-btn">OK</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ================= Appelboom v7 - Mobile Optimized ================= */

(async function(){
  if(typeof settings === 'undefined'){
    alert('Ø§Ù„Ù…Ù„Ù config.js ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯.');
    return;
  }

  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

  // Ø¹Ù†Ø§ØµØ± DOM
  const bg = document.getElementById('bg');
  const heroTree = document.getElementById('heroTree');
  const gameTree = document.getElementById('gameTree');
  const heroApples = document.getElementById('heroApples');
  const treeApples = document.getElementById('treeApples');
  const wordInput = document.getElementById('wordInput');
  const startBtn = document.getElementById('startBtn');
  const langCol = document.getElementById('langCol');
  const langEls = langCol.querySelectorAll('.lang-btn');
  const soundToggle = document.getElementById('soundToggle');
  const pageSetup = document.getElementById('pageSetup');
  const pageGame = document.getElementById('pageGame');
  const slotsRow = document.getElementById('slotsRow');
  const alphabetDiv = document.getElementById('alphabet');
  const fallenColumns = document.getElementById('fallenColumns');
  const newBtn = document.getElementById('newBtn');
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalMedia = document.getElementById('modalMedia');
  const modalDesc = document.getElementById('modalDesc');
  const modalOk = document.getElementById('modalOk');

  // ================= ğŸ†• Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© =================
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    return false;
  });

  document.addEventListener('keydown', function(e) {
    if (!pageGame.classList.contains('active')) return;
    
    const key = e.key.toUpperCase();
    const currentAlphabet = ALPHABETS[state.lang] || ALPHABETS.nl;
    const isValidKey = currentAlphabet.includes(key) || 
                      (state.lang === 'ar' && currentAlphabet.includes(e.key));
    
    if (isValidKey) {
      const letterBtn = Array.from(state.alphabetButtons).find(btn => 
        btn.dataset.letter === key || 
        (state.lang === 'ar' && btn.dataset.letter === e.key)
      );
      
      if (letterBtn && !letterBtn.classList.contains('disabled')) {
        letterBtn.click();
      }
    }
    
    if (e.key === 'Enter' && pageGame.classList.contains('active')) {
      newBtn.click();
    }
  });

  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ù„ÙÙŠØ© Ùˆ Ø§Ù„ØµÙˆØ±
  bg.style.backgroundImage = `url("${settings.images.background}")`;
  heroTree.src = settings.images.tree;
  gameTree.src = settings.images.tree;

  if (settings.advanced) {
    if (settings.advanced.tree && settings.advanced.tree.setupPage) {
      heroTree.style.width = settings.advanced.tree.setupPage.width;
      heroTree.style.maxWidth = settings.advanced.tree.setupPage.maxWidth;
    }
    
    if (settings.advanced.tree && settings.advanced.tree.gamePage) {
      gameTree.style.width = settings.advanced.tree.gamePage.width;
      gameTree.style.maxWidth = settings.advanced.tree.gamePage.maxWidth;
    }
  }

  const ALPHABETS = {
    nl: ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","Ã","Ã€","Ã‰","Ãˆ","Ã‹","Ã","Ã","Ã“","Ã–","Ãš","Ãœ"],
    en: ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],
    ar: ["Ø§","Ø£","Ø¥","Ø¢","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","Ø¤","ÙŠ","Ø¦","Ù‰"]
  };

  const state = {
    lang: 'nl',
    wordRaw: '',
    wordChars: [],
    maxApples: 0,
    apples: [],
    fallenCount: 0,
    slots: [],
    alphabetButtons: [],
    audioEnabled: !!settings.options.sound_enabled,
    successIndex: 0,
    failIndex: 0,
    arabicWords: null,
  };

  async function loadArabicWords(){
    try{
      const resp = await fetch(settings.options.arabicWordsFile);
      if(!resp.ok) throw new Error('no ar words');
      state.arabicWords = await resp.json();
    }catch(e){
      state.arabicWords = null;
      console.warn('Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ© Ù…Ø­Ù„ÙŠ:', e);
    }
  }
  await loadArabicWords();

  function playAudio(src, vol=1){
    if(!state.audioEnabled) return;
    try{
      const a = new Audio(src);
      a.volume = Math.min(1, vol);
      a.play().catch(()=>{});
    }catch(e){ console.warn('audio play error', e); }
  }

  function uiClick(){ playAudio(settings.sounds.click, 0.12); }

  let birdsStarted = false;

  function playBirds(){ 
    if(state.audioEnabled && !birdsStarted) { 
      try{ 
        birdsAudio.play().catch(()=>{}); 
        birdsStarted = true;
      }catch(e){} 
    } 
  }

  function stopBirds(){ 
    try{ 
      birdsAudio.pause(); 
      birdsAudio.currentTime = 0; 
      birdsStarted = false;
    }catch(e){} 
  }

  const birdsAudio = new Audio(settings.sounds.birds);
  birdsAudio.loop = true;
  birdsAudio.volume = 0.25;

  soundToggle.addEventListener('click', ()=>{
    state.audioEnabled = !state.audioEnabled;
    
    if(state.audioEnabled) {
      soundToggle.classList.remove('muted');
      soundToggle.setAttribute('aria-label', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª');
    } else {
      soundToggle.classList.add('muted');
      soundToggle.setAttribute('aria-label', 'ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
    }
    
    uiClick();
    if(state.audioEnabled) playBirds(); else stopBirds();
  });

  if(state.audioEnabled) {
    soundToggle.classList.remove('muted');
  } else {
    soundToggle.classList.add('muted');
  }

  document.addEventListener('click', function first(){
    if(state.audioEnabled) playBirds();
    document.removeEventListener('click', first);
  });

  function updateInputPlaceholder() {
    if(state.lang === 'ar') {
      wordInput.placeholder = 'Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©...';
    } else if(state.lang === 'en') {
      wordInput.placeholder = 'Type the word...';
    } else {
      wordInput.placeholder = 'Typ het woord...';
    }
  }

  langEls.forEach(el=>{
    el.addEventListener('click', ()=>{
      langEls.forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      state.lang = el.dataset.lang;
      updateInputPlaceholder();
      uiClick();
      renderAlphabet(); // Ø§Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø­Ø±ÙˆÙ Ù„Ù…Ø§ ÙŠØªØºÙŠØ± Ø§Ù„Ù„ØºØ©
    })
  });

  function renderHeroApples(){
    heroApples.innerHTML = '';
    const positions = [
      {x:13,y:-2},{x:23,y:5},{x:33,y:-2},{x:43,y:5},{x:53,y:-2},{x:63,y:5},{x:73,y:-2},
      {x:4,y:30},{x:14,y:37},{x:24,y:30},{x:34,y:37},{x:44,y:30},{x:54,y:37},{x:64,y:30},{x:74,y:37},{x:84,y:30}
    ];
    const label = 'KHALEDSAPPELBOOM'.split('');
    positions.forEach((p,i)=>{
      const w = document.createElement('div'); w.className='apple-item';
      w.style.left = p.x + '%'; w.style.top = p.y + '%';
      const img = document.createElement('img');
      img.src = settings.images.appleTransparent;
      img.style.width = '38px';
      img.style.height = 'auto';
      img.style.opacity = '0.85';
      w.appendChild(img);
      const span = document.createElement('div');
      span.textContent = label[i % label.length];
      span.style.position='absolute'; span.style.left='50%'; span.style.top='50%';
      span.style.transform='translate(-50%,-52%)'; span.style.fontWeight='900'; span.style.fontSize='18px'; span.style.color='#000';
      w.appendChild(span);
      heroApples.appendChild(w);
    });
  }
  renderHeroApples();

  wordInput.addEventListener('input', ()=> {
    // Ø§Ù„Ù†Ù‚Ø§Ø· ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ø¨Ø± CSS
  });

  async function checkDictionary(word){
    if(!settings.options.check_dictionary_online) return true;
    if(state.lang === 'en' || state.lang === 'nl'){
      const langCode = state.lang === 'en' ? 'en' : 'nl';
      const url = `https://api.dictionaryapi.dev/api/v2/entries/${langCode}/${encodeURIComponent(word)}`;
      try{
        const res = await fetch(url);
        if(res.ok) return true;
        else return false;
      }catch(e){
        console.warn('Dictionary API error', e);
        return false;
      }
    } else if(state.lang === 'ar'){
      if(!state.arabicWords) return false;
      return state.arabicWords.includes(word);
    }
    return false;
  }

  startBtn.addEventListener('click', async ()=>{
    uiClick();
    const raw = (wordInput.value || '').trim();
    if(!raw){
      alert(state.lang==='ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø©.' : (state.lang==='nl' ? 'Voer een woord in.' : 'Please enter a word.'));
      return;
    }
    const word = state.lang === 'ar' ? raw : raw.toUpperCase();
    if(settings.options.check_dictionary_online){
      const ok = await checkDictionary(word);
      if(!ok){
        modalTitle.textContent = state.lang==='ar' ? 'Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©' : 'Word not found';
        modalDesc.textContent = state.lang==='Ø§Ø±' ? 'Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³. Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªÙ‡Ø¬Ø¦Ø©.' : 'Word not found in dictionary. Check spelling.';
        modalMedia.innerHTML = '';
        modal.classList.add('show');
        playAudio(settings.sounds.failList[0], 0.18);
        return;
      }
    }
    state.wordRaw = word;
    state.wordChars = word.split('');
    state.maxApples = word.replace(/\s/g,'').length;
    pageSetup.classList.remove('active');
    pageGame.classList.add('active');
    buildGameBoard();
  });

  modalOk.addEventListener('click', ()=>{
    uiClick();
    modal.classList.remove('show');
  });

  function buildGameBoard(){
    treeApples.innerHTML = ''; fallenColumns.innerHTML = ''; slotsRow.innerHTML = ''; alphabetDiv.innerHTML = '';
    state.apples = []; state.slots = []; state.alphabetButtons = []; state.fallenCount = 0;

    const n = state.maxApples;
    let appleSize = settings.options.appleSizeBasePx;
    if(n>12) appleSize = Math.max(30, appleSize - 6);
    if(n>20) appleSize = Math.max(24, appleSize - 10);

    const cols = Math.min(6, Math.ceil(Math.sqrt(n)));
    const rows = Math.ceil(n/cols);
    let idx = 0;
    
    const treeContainer = document.querySelector('.game-tree-frame');
    const treeWidthPercent = 85;
    const offsetPercent = (100 - treeWidthPercent) / 2;
    
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        if(idx>=n) break;
        const left = 4 + (c + (r%2?0.16:0)) * (62/cols) + (Math.random()*4 -2);
        const top = 10 + r * (70/rows) + (Math.random()*6 -3);
        const wrap = document.createElement('div'); wrap.className='apple-item';
        
        wrap.style.left = `calc(${left}% + ${offsetPercent / 2}%)`; 
        wrap.style.top = top + '%';
        
        wrap.dataset.index = idx; wrap.dataset.fallen = 'false';
        const img = document.createElement('img'); img.src = settings.images.apple; img.style.width = appleSize + 'px';
        wrap.appendChild(img);
        treeApples.appendChild(wrap);
        state.apples.push(wrap);
        idx++;
      }
    }

    renderSlots();
    renderAlphabet();

    document.documentElement.style.setProperty('--slot-font', settings.options.slotFontSizePx + 'px');
    document.documentElement.style.setProperty('--slot-gap', settings.options.slotUnderscoreSpacing + 'px');
  }

  function renderSlots(){
    slotsRow.innerHTML = ''; state.slots = [];
    state.wordChars.forEach((ch, i)=>{
      const s = document.createElement('div'); s.className = 'slot'; s.dataset.pos = i;
      if(ch === ' ') { s.classList.add('space'); s.textContent = ' '; } else { s.textContent = '_'; }
      slotsRow.appendChild(s); state.slots.push(s);
    });
    
    const wordLength = state.wordChars.filter(ch => ch !== ' ').length;
    
    slotsRow.classList.remove('short-word', 'medium-word', 'long-word', 'very-long-word', 'extremely-long-word');
    
    if (wordLength <= 8) {
        slotsRow.classList.add('short-word');
    } else if (wordLength <= 16) {
        slotsRow.classList.add('medium-word');
    } else if (wordLength <= 24) {
        slotsRow.classList.add('long-word');
    } else if (wordLength <= 30) {
        slotsRow.classList.add('very-long-word');
    } else {
        slotsRow.classList.add('extremely-long-word');
    }
  }

  function renderAlphabet(){
    alphabetDiv.innerHTML = '';
    const arr = ALPHABETS[state.lang] || ALPHABETS.nl;
    const letters = (state.lang === 'ar') ? arr.slice().reverse() : arr.slice();
    letters.forEach(l=>{
      const btn = document.createElement('button'); 
      btn.className='letter-btn'; 
      btn.textContent = l; 
      btn.dataset.letter = l;
      
      if (isMobile) {
        btn.style.minWidth = '54px';
        btn.style.minHeight = '48px';
        btn.style.padding = '12px';
        btn.style.fontSize = '18px';
      }
      
      btn.addEventListener('click', onLetterClick); 
      alphabetDiv.appendChild(btn); 
      state.alphabetButtons.push(btn);
    });
    alphabetDiv.style.direction = (state.lang==='ar') ? 'rtl' : 'ltr';
  }

  function onLetterClick(e){
    const btn = e.currentTarget; if(btn.classList.contains('disabled')) return;
    btn.classList.add('disabled'); btn.disabled = true; uiClick();
    const letter = btn.dataset.letter;
    handleGuess(letter);
  }

  function handleGuess(letter){
    let match = false;
    state.wordChars.forEach(ch => {
      if(ch === ' ') return;
      if(state.lang === 'ar'){ if(ch === letter) match = true; }
      else { if(ch.toUpperCase() === letter.toUpperCase()) match = true; }
    });

    if(match){
      revealLetter(letter);
      
      const isLastLetter = checkIfLastLetter();
      
      if (!isLastLetter) {
        const list = settings.sounds.successList || [];
        if(list.length) playAudio(list[state.successIndex % list.length], 0.18);
        state.successIndex++;
      }
      
      checkWin();
    } else {
      triggerAppleFall(letter);
    }
  }

  function checkIfLastLetter() {
    let revealedCount = 0;
    state.wordChars.forEach((ch, idx) => {
      if(ch !== ' ' && state.slots[idx].textContent !== '_') {
        revealedCount++;
      }
    });
    return revealedCount + 0 >= state.maxApples;
  }

  function revealLetter(letter){
    state.wordChars.forEach((ch, idx)=>{
      if(ch === ' ') return;
      const equal = (state.lang === 'ar') ? (ch === letter) : (ch.toUpperCase() === letter.toUpperCase());
      if(equal){
        state.slots[idx].textContent = ch;
        state.slots[idx].style.color = '#0b8a3a';
        state.slots[idx].classList.add('revealed');
      }
    });
  }

  function triggerAppleFall(letter){
    const appleEl = state.apples.find(a => a.dataset.fallen === 'false');
    if(!appleEl) return;
    appleEl.dataset.fallen = 'true';
    appleEl.style.opacity = '0.14';

    state.fallenCount++;
    
    const isLastApple = state.fallenCount >= state.maxApples;
    
    const rect = appleEl.getBoundingClientRect();
    const clone = appleEl.cloneNode(true);
    clone.style.position = 'fixed';
    clone.style.left = (rect.left + rect.width/2) + 'px';
    clone.style.top = (rect.top + rect.height/2) + 'px';
    clone.style.transform = 'translate(-50%,-50%) scale(1)';
    clone.style.zIndex = 9999;
    document.body.appendChild(clone);

    const perCol = settings.options.maxApplesPerColumn || 3;
    const colIndex = Math.floor((state.fallenCount - 1) / perCol);
    let colEl = fallenColumns.querySelector(`.fallen-column[data-col='${colIndex}']`);
    if(!colEl){ colEl = document.createElement('div'); colEl.className = 'fallen-column'; colEl.dataset.col = colIndex; fallenColumns.appendChild(colEl); }

    const temp = document.createElement('div'); temp.style.width='1px'; temp.style.height='1px'; temp.style.opacity='0';
    colEl.appendChild(temp);
    const targetRect = temp.getBoundingClientRect();

    if(!isLastApple && state.audioEnabled) playAudio(settings.sounds.fallWhistle, 0.16);

    const fallDur = settings.options.fallDurationMs || 700;
    const bounceDur = settings.options.bounceDurationMs || 420;
    const tilt = settings.options.bounceTiltDeg || 28;

    requestAnimationFrame(()=> {
      clone.style.transition = `top ${fallDur}ms cubic-bezier(.2,.9,.2,1)`;
      clone.style.top = (targetRect.top - 28) + 'px';
    });

    setTimeout(()=>{
      if(!isLastApple && state.audioEnabled) playAudio(settings.sounds.impact, 0.16);
      const tx = targetRect.left + (targetRect.width/2);
      const ty = targetRect.top + (targetRect.height/2);
      clone.style.transition = `left ${bounceDur}ms cubic-bezier(.2,.9,.2,1), top ${bounceDur}ms cubic-bezier(.2,.9,.2,1), transform ${bounceDur}ms ease`;
      clone.style.left = tx + 'px';
      clone.style.top = ty + 'px';
      clone.style.transform = `translate(-50%,-50%) scale(0.92) rotate(${tilt}deg)`;
      if(!isLastApple && state.audioEnabled && settings.sounds.slide) playAudio(settings.sounds.slide, 0.12);
    }, fallDur + 20);

    setTimeout(()=>{
      if(clone && clone.parentNode) clone.parentNode.removeChild(clone);
      const item = document.createElement('div'); item.className='fallen-item';
      const imgWrap = document.createElement('div'); imgWrap.innerHTML = appleEl.innerHTML;
      imgWrap.querySelector('img').style.width = '44px';
      const letterEl = document.createElement('div'); letterEl.className='fallen-letter'; letterEl.textContent = letter;
      item.appendChild(imgWrap); item.appendChild(letterEl);
      colEl.appendChild(item);
      if(temp && temp.parentNode) temp.parentNode.removeChild(temp);
      
      if(!isLastApple) {
        const fl = settings.sounds.failList || [];
        if(fl.length) playAudio(fl[state.failIndex % fl.length], 0.18);
        state.failIndex++;
      }
      
      checkLose();
    }, fallDur + bounceDur + 60);
  }

  function checkWin(){
    const unfinished = state.slots.some(s => s.textContent === '_');
    if(!unfinished){
      stopBirds();
      
      state.slots.forEach(s=>{ if(s.textContent !== ' ') s.style.color = '#0b8a3a'; });
      modalTitle.textContent = state.lang==='ar' ? 'Ù…Ø¨Ø±ÙˆÙƒ!' : (state.lang==='nl' ? 'Gefeliciteerd!' : 'Congratulations!');
      modalDesc.textContent = (state.lang==='ar') ? 'Ù„Ù‚Ø¯ Ø®Ù…Ù†Øª Ø§Ù„ÙƒÙ„Ù…Ø©!' : `The word was: ${state.wordRaw}`;
      modalMedia.innerHTML = `<img src="${settings.images.crowdWin}" alt="win" onerror="this.style.display='none'">`;
      modal.classList.add('show');
      
      setTimeout(() => {
        if(settings.sounds.successMessage) playAudio(settings.sounds.successMessage, 0.22);
      }, 300);
    }
  }

  function checkLose(){
    if(state.fallenCount >= state.maxApples){
      stopBirds();
      
      state.slots.forEach((slot, idx)=>{ const ch = state.wordChars[idx]; if(ch === ' ') return; slot.textContent = ch; slot.style.color = '#c73737';});
      modalTitle.textContent = state.lang==='ar' ? 'Ø§Ù†ØªÙ‡Øª Ø§Ù„ØªÙØ§Ø­Ø§Øª' : (state.lang==='nl' ? 'Alle appels zijn gevallen' : 'Apples finished');
      modalDesc.textContent = (state.lang==='ar') ? `Ø§Ù„ÙƒÙ„Ù…Ø© ÙƒØ§Ù†Øª: ${state.wordRaw}` : `The word was: ${state.wordRaw}`;
      modalMedia.innerHTML = `<img src="${settings.images.crowdFail}" alt="fail" onerror="this.style.display='none'">`;
      modal.classList.add('show');
      
      setTimeout(() => {
        if(settings.sounds.failMessage) playAudio(settings.sounds.failMessage, 0.22);
      }, 300);
    }
  }

  newBtn.addEventListener('click', ()=>{
    uiClick();
    pageGame.classList.remove('active'); 
    pageSetup.classList.add('active');
    treeApples.innerHTML = ''; 
    fallenColumns.innerHTML = ''; 
    slotsRow.innerHTML = ''; 
    alphabetDiv.innerHTML = '';
    wordInput.value = '';
    state.wordRaw = ''; 
    state.wordChars = []; 
    state.maxApples = 0; 
    state.apples = []; 
    state.fallenCount = 0; 
    state.slots = [];
    
    setTimeout(() => {
      document.addEventListener('click', function restartBirds(){
        if(state.audioEnabled && pageSetup.classList.contains('active')) {
          playBirds();
          document.removeEventListener('click', restartBirds);
        }
      });
    }, 100);
  });

  wordInput.addEventListener('keydown', function(e){
    if(e.key === 'Enter'){ uiClick(); startBtn.click(); }
  });

  window.Appelboom = { settings, state };

})();
</script>
</body>
</html>
